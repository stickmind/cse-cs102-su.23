# 位掩码

<div class="toc"></div>

位操作在嵌入式等涉及到硬件操作的领域应用较为广泛，其中一个应用场景是对一组位模式进行选择性操作，即屏蔽掉部分位，只对感兴趣的部分进行修改，这种操作称为**位掩码**（Bitmask）。

位运算在底层库、嵌入式、网络、图形学领域有大量应用，即使不深入底层，掌握这些常见操作也是非常有必要的。

## 将指定的位设置为 1

置 1 操作，即打开某些位，可以使用按位或运算 `|` 。

- `Y | 1 = 1`：按位或运算 `|` 搭配 1 可以将位设置为 1
- `Y | 0 = Y`：按位或运算 `|` 搭配 0 可以保持位状态不变

示例：在较高的半字节（位 4、5、6、7）上置 1，同时保持较低的半字节（位 0、1、2、3）不变。

```
   10010101   10100101
 | 11110000   00010000
   --------   --------
   11110101   10110101
```

以上示例也可以理解为，求两组位模式的**并集**。

## 将指定的位设置为 0

在实践中，更常见的是置 0 操作，可以使用按位与运算 `&`。

- `Y & 1 = Y`：按位与运算 `&` 搭配 0 可以将位设置为 0
- `Y & 0 = 0`：按位与运算 `&` 搭配 1 可以保持位状态不变

示例：在较高的半字节（位 4、5、6、7）上置 0，同时保持较低的半字节（位 0、1、2、3）不变。

```
   10010101   10100101
 & 00001111   11001111
   --------   --------
   00000101   10000101
```

以上示例也可以理解为，求两组位模式的**交集**。

## 查询某个位的状态

按位与运算 `&` 稍作变化就可以进行查询操作。结果为 `true`，则查询的位是 1；结果为 `false`，则查询的位为 0。

示例：查询第 4 个位的状态

```
  10011101   10010101
& 00001000   00001000
  --------   --------
  00001000   00000000
```

## 切换位的状态

上述应用，要么同时打开某些位，要么同时关闭某些位，但有些情况下，我们需要关闭一部分位的同时打开另一部分。
按位异或位操作 `^` 可以实现精准的控制。当且仅当 1 的数量为单数时，异或的结果为 1，所以对于 `Y XOR 1`

- 当 `Y = 1` 时，1 的数量不为单数，`1 XOR 1` 结果为 0
- 当 `Y = 0` 时，1 的数量为单数，`0 XOR 1` 结果为 1

示例：将第一组较低的半字节（位 0、1、2、3）切换状态，较高的半字节（位 4、5、6、7）保持不变；将第二组所有位切换状态

```
  10011101   10010101
^ 00001111   11111111
  --------   --------
  10010010   01101010
```

对于第二组，如果目的是切换所有位模式，也可以使用按位取反位操作 `~`。

```
~ 10010101
  --------
  01101010
```
